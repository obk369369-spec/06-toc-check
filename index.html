<!doctype html>
<html lang="ko">
<meta charset="utf-8">
<title>TOC Check</title>
<style>
  body{font-family:system-ui;margin:12px;max-width:900px}
  .row{display:flex;gap:6px;flex-wrap:wrap;align-items:center}
  input,button{padding:6px}
  table{border-collapse:collapse;width:100%;margin-top:8px}
  th,td{border:1px solid #ccc;padding:6px;font-size:12px;vertical-align:top}
</style>

<div class="row">
  <input id="id" placeholder="ID">
  <input id="name" placeholder="기준점 이름">
  <button id="add">추가</button>
</div>

<table>
  <thead>
    <tr>
      <th>PASS/X 개수</th>
      <th>PASS/X 기준점 목록</th>
      <th>PASS↔X 변경 이력</th>
      <th>미판단 기준점 목록</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="cnt"></td>
      <td id="list"></td>
      <td id="hist"></td>
      <td id="pend"></td>
    </tr>
  </tbody>
</table>

<script>
const K="toc_check_safe_v1";
const now=()=>new Date().toISOString().slice(0,19).replace("T"," ");
const S=()=>JSON.parse(localStorage.getItem(K)||'{"i":[],"h":[]}');
const W=s=>localStorage.setItem(K,JSON.stringify(s));

function R(){
  const s=S();
  const p=s.i.filter(x=>x.s==="PASS").length;
  const x=s.i.filter(x=>x.s==="X").length;
  const n=s.i.filter(x=>!x.s).length;
  cnt.textContent=`PASS ${p} / X ${x} / 미판단 ${n}`;
  list.innerHTML=s.i.map(o=>{
    const st=o.s||"미판단";
    return `<div>
      [${st}] ${o.id} ${o.n}
      <button data-id="${o.id}" data-s="PASS">PASS</button>
      <button data-id="${o.id}" data-s="X">X</button>
      <button data-del="${o.id}">삭제</button>
    </div>`;
  }).join("")||"-";
  pend.textContent=s.i.filter(o=>!o.s).map(o=>`${o.id} ${o.n}`).join(", ")||"-";
  hist.textContent=s.h.map(e=>`${e.t} ${e.id} ${e.f}→${e.t2}`).join("\n")||"-";
}

add.onclick=()=>{
  const idv=id.value.trim(), nv=name.value.trim();
  if(!idv||!nv) return;
  const s=S();
  if(s.i.some(o=>o.id===idv)) return;
  s.i.push({id:idv,n:nv,s:""});
  W(s); id.value=""; name.value=""; R();
};

document.onclick=e=>{
  const b=e.target;
  const s=S();
  if(b.dataset&&b.dataset.id){
    const o=s.i.find(z=>z.id===b.dataset.id);
    const f=o.s||"미판단";
    const t=b.dataset.s;
    o.s=t;
    if((f==="PASS"&&t==="X")||(f==="X"&&t==="PASS"))
      s.h.push({t:now(),id:o.id,f:f,t2:t});
    W(s); R();
  }
  if(b.dataset&&b.dataset.del){
    s.i=s.i.filter(z=>z.id!==b.dataset.del);
    W(s); R();
  }
};

R();
</script>
</html>
